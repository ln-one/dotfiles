{{- if ne .chezmoi.os "windows" }}
# ========================================
# Zsh Environment Configuration
# ========================================
# This file is loaded in all Zsh sessions
# Used to set environment variables and basic configuration

{{- if eq .chezmoi.os "linux" }}
# Linux specific configuration
# Skip global compinit to avoid conflict with Zim completion module
skip_global_compinit=1
{{- end }}

# Set Zim related environment variable (keep default path for compatibility)
export ZIM_HOME="${ZDOTDIR:-${HOME}}/.zim"

# Performance optimization - reduce checks at startup
export ZSH_DISABLE_COMPFIX=true

{{- if and (hasKey . "features") .features.enable_fzf }}
# fzf environment variable (set early for other tools)
export FZF_BASE="${HOME}/.fzf"
{{- end }}

# Ensure ~/.local/bin is in PATH (set early)
if [[ ":$PATH:" != *":$HOME/.local/bin:"* ]]; then
    export PATH="$HOME/.local/bin:$PATH"
fi

{{- if eq .chezmoi.os "darwin" }}
# macOS specific early environment setup
{{- if stat "/opt/homebrew" }}
export HOMEBREW_PREFIX="/opt/homebrew"
{{- else if stat "/usr/local" }}
export HOMEBREW_PREFIX="/usr/local"
{{- end }}

{{- if or (stat "/opt/homebrew") (stat "/usr/local") }}
# Early set Homebrew PATH
export PATH="$HOMEBREW_PREFIX/bin:$HOMEBREW_PREFIX/sbin:$PATH"
{{- end }}
{{- end }}

{{- end }}