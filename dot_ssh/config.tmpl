# ===============================
# Personal server Aliyun (1Password keys)
# ===============================
Host aliyun  
    HostName "{{ .secrets.aliyun_server_url }}"
    User "{{ .secrets.aliyun_server_username }}"
{{- if eq .chezmoi.os "windows" }}
    # Let SSH use the default agent (1Password manages this automatically)
    # IdentityAgent \\.\pipe\1password-ssh-agent
{{- else }}
    IdentityAgent ~/.1password/agent.sock
{{- end }}

# ===============================
# GitHub (1Password keys)
# ===============================
Host github.com
    HostName ssh.github.com
    User git
    Port 443
{{- if eq .chezmoi.os "windows" }}
    # Let SSH use the default agent (1Password manages this automatically)
    # IdentityAgent \\.\pipe\1password-ssh-agent
{{- else }}
    IdentityAgent ~/.1password/agent.sock
{{- end }}
{{- if and .features.enable_proxy .proxy.enabled }}
    {{- if hasKey .proxy "socks_port" }}
    ProxyCommand nc -X 5 -x {{ .proxy.host }}:{{ .proxy.socks_port }} %h %p
    {{- end }}
{{- end }}

# ===============================
# YubiKey-only hosts
# ===============================
Host secure-server yubikey-*
{{- if eq .chezmoi.os "windows" }}
    IdentityAgent \\.\pipe\openssh-ssh-agent
{{- else }}
    IdentityAgent $SSH_AUTH_SOCK  # Will point to YubiKey agent dynamically
{{- end }}

# ===============================
# Default for all other hosts
# ===============================
Host *
{{- if eq .chezmoi.os "windows" }}
    # Let SSH use the default agent (1Password manages this automatically)
    # IdentityAgent \\.\pipe\1password-ssh-agent
{{- else }}
    IdentityAgent ~/.1password/agent.sock
{{- end }}