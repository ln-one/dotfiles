#!/bin/bash
# ========================================
# Oh My Zsh å®‰è£…è„šæœ¬ (Chezmoi ç®¡ç†)
# ========================================
# è‡ªåŠ¨å®‰è£…å’Œé…ç½® Oh My Zsh æ¡†æ¶
# åªåœ¨å¯ç”¨ Oh My Zsh åŠŸèƒ½æ—¶è¿è¡Œ

{{- if .features.enable_oh_my_zsh }}

set -euo pipefail

echo "ğŸš€ å¼€å§‹å®‰è£… Oh My Zsh..."

# æ£€æŸ¥æ˜¯å¦å·²å®‰è£…
if [ -d "$HOME/.oh-my-zsh" ]; then
    echo "âœ… Oh My Zsh å·²å®‰è£…ï¼Œè·³è¿‡å®‰è£…æ­¥éª¤"
    exit 0
fi

# æ£€æŸ¥å¿…éœ€å·¥å…·
if ! command -v curl >/dev/null 2>&1; then
    echo "âŒ é”™è¯¯: éœ€è¦ curl æ¥ä¸‹è½½ Oh My Zsh"
    exit 1
fi

if ! command -v zsh >/dev/null 2>&1; then
    echo "âŒ é”™è¯¯: éœ€è¦å…ˆå®‰è£… zsh"
    exit 1
fi

# ä¸‹è½½å¹¶å®‰è£… Oh My Zsh (æ— äººå€¼å®ˆæ¨¡å¼)
echo "ğŸ“¥ ä¸‹è½½ Oh My Zsh å®‰è£…è„šæœ¬..."
RUNZSH=no CHSH=no sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" || {
    echo "âŒ Oh My Zsh å®‰è£…å¤±è´¥"
    exit 1
}

echo "âœ… Oh My Zsh å®‰è£…å®Œæˆ"

# å®‰è£…å¸¸ç”¨æ’ä»¶
echo "ğŸ“¦ å®‰è£… Oh My Zsh æ’ä»¶..."

# zsh-autosuggestions
if [ ! -d "$HOME/.oh-my-zsh/custom/plugins/zsh-autosuggestions" ]; then
    git clone https://github.com/zsh-users/zsh-autosuggestions.git \
        "$HOME/.oh-my-zsh/custom/plugins/zsh-autosuggestions" || {
        echo "âš ï¸  è­¦å‘Š: zsh-autosuggestions æ’ä»¶å®‰è£…å¤±è´¥"
    }
fi

# zsh-syntax-highlighting
if [ ! -d "$HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting" ]; then
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git \
        "$HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting" || {
        echo "âš ï¸  è­¦å‘Š: zsh-syntax-highlighting æ’ä»¶å®‰è£…å¤±è´¥"
    }
fi

echo "âœ… Oh My Zsh æ’ä»¶å®‰è£…å®Œæˆ"
echo "ğŸ‰ Oh My Zsh é…ç½®å®Œæˆï¼é‡æ–°å¯åŠ¨ç»ˆç«¯æˆ–è¿è¡Œ 'source ~/.zshrc' æ¥åº”ç”¨æ›´æ”¹"

{{- else }}
echo "â„¹ï¸  Oh My Zsh åŠŸèƒ½å·²ç¦ç”¨ï¼Œè·³è¿‡å®‰è£…"
{{- end }}