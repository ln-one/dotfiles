# 环境变量统一管理重构

## 提交概述

本次提交完成了环境变量配置的统一管理重构，将分散在各个配置文件中的环境变量集中到 `environment.sh` 中管理，提升了配置的可维护性和 shell 启动性能。

## 主要变更

### 1. 环境变量集中管理
- **新增**: 在 `environment.sh` 中统一管理所有环境变量
- **迁移**: 将 fnm 和 fzf 的环境变量从各自配置文件迁移到 `environment.sh`
- **优化**: 使用条件模板语法进行平台和功能特定配置

### 2. fnm 配置优化
- **位置变更**: 从 `oh-my-zsh-config.sh` 迁移到 `environment.sh`
- **性能优化**: 添加 `--log-level=quiet` 参数抑制启动输出
- **问题解决**: 消除 "Using Node for alias lts-latest" 启动消息

### 3. fzf 配置重构
- **环境变量迁移**: 所有 fzf 环境变量移至 `environment.sh`
- **职责分离**: `fzf-config.sh` 现在只负责函数和 shell 集成
- **配置完整性**: 保持所有 fzf 功能完整可用

### 4. 配置文件职责优化
- **`environment.sh`**: 环境变量中心，统一管理所有环境配置
- **`oh-my-zsh-config.sh`**: 专注于 Oh My Zsh 插件和主题配置
- **`fzf-config.sh`**: 专注于 fzf 函数和 shell 集成

### 5. 文档更新
- **更新**: `docs/environment-management.md` 详细说明新的管理结构
- **整合**: 包含重构前后对比和最佳实践指南
- **关联**: 添加相关文档链接

## 技术改进

### 性能优化
- 减少重复的环境变量设置
- 静默 fnm 初始化，消除启动输出
- 优化配置加载顺序

### 代码质量
- 消除配置重复和冲突
- 清晰的职责分离
- 统一的配置管理模式

### 可维护性
- 集中的环境变量管理
- 清晰的文档说明
- 标准化的配置结构

## 影响范围

### 用户体验
- **启动速度**: 可能略微提升 shell 启动速度
- **输出清洁**: 消除 fnm 启动时的输出信息
- **功能完整**: 所有现有功能保持不变

### 开发体验
- **配置维护**: 更容易管理和修改环境变量
- **问题排查**: 集中的配置便于调试
- **扩展性**: 新工具的环境变量有明确的添加位置

## 测试建议

1. **应用配置**: 运行 `chezmoi apply` 应用新配置
2. **重启 shell**: 重新启动终端或运行 `source ~/.zshrc`
3. **功能验证**: 
   - 测试 fnm 版本切换功能
   - 验证 fzf 搜索和预览功能
   - 检查其他工具的环境变量是否正常
4. **性能测试**: 运行 `time zsh -i -c exit` 测试启动时间

## 后续计划

- 监控配置应用后的用户反馈
- 根据需要进一步优化启动性能
- 考虑将其他工具的环境变量也迁移到统一管理

---

**提交类型**: refactor  
**影响范围**: 配置管理, 性能优化  
**破坏性变更**: 无  
**测试要求**: 功能验证