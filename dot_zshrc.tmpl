# ========================================
# Zsh 配置文件 (Chezmoi 管理)
# ========================================
# 性能监控 (开发时使用)
# zmodload zsh/zprof

{{ includeTemplate "shell-common.sh" . }}
# Shell 性能优化
{{ includeTemplate "core/zsh-performance-tweaks.sh" . }}
# Shell 特定配置 (仅在对应 shell 中加载)
{{- if eq (base .chezmoi.targetFile) ".zshrc" }}
# Zsh 特定配置

# Zsh 框架配置 - 根据特性标志选择框架
{{- if .features.enable_zim }}
# Zim 框架配置 (包含补全系统管理)
{{ includeTemplate "core/zim-config.sh" . }}
{{- else }}
# 无框架模式 - 仅加载基础 Zsh 配置
# 基础补全系统 (仅在无框架模式下手动初始化)
autoload -Uz compinit
# 优化补全加载 - 每天只检查一次
local zcompdump="${ZDOTDIR:-$HOME}/.zcompdump"
if [[ $zcompdump(#qNmh+24) ]]; then
    compinit -d "$zcompdump"
else
    compinit -C -d "$zcompdump"
fi
{{- end }}
{{- end }}

# 初始化 zsh-defer (仅在zsh和启用 Zim 时，必须在 evalcache 之前)
{{- if and .features.enable_zim (eq (base .chezmoi.targetFile) ".zshrc") }}
{{ includeTemplate "core/zsh-defer-init.sh" . }}

# Evalcache 配置 - 缓存 eval 语句以加速启动 (完全静态版本)
{{ includeTemplate "init/zsh_init.sh" . }}

{{- end }}

# 性能监控结果 (开发时使用)
# zprof