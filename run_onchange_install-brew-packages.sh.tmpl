#!/bin/bash
# Homebrew package installation script
# Use Brewfile to install and manage packages
# Requirements: 4.1, 4.2, 8.1

set -euo pipefail

echo "🍺 Installing Homebrew packages..."

# Brewfile path
BREWFILE_PATH="{{ .chezmoi.homeDir }}/Brewfile"

# Check if Brewfile exists, generate from template if not
if [[ ! -f "$BREWFILE_PATH" ]]; then
    echo "📝 Brewfile not found, generating from template..."
    chezmoi execute-template < "{{ .chezmoi.sourceDir }}/Brewfile.tmpl" > "$BREWFILE_PATH"
    echo "✅ Brewfile generated: $BREWFILE_PATH"
fi

echo "📋 Using Brewfile: $BREWFILE_PATH"

# Run brew bundle install
echo "⚡ Running brew bundle install..."
brew bundle install --file="$BREWFILE_PATH"

echo "🎉 Homebrew package installation complete!"