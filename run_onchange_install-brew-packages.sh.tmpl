#!/bin/bash
# Homebrew åŒ…å®‰è£…è„šæœ¬
# ä½¿ç”¨ Brewfile å®‰è£…å’Œç®¡ç†å·¥å…·åŒ…
# Requirements: 4.1, 4.2, 8.1

set -euo pipefail

echo "ğŸº å®‰è£… Homebrew åŒ…..."

# Brewfile è·¯å¾„
BREWFILE_PATH="{{ .chezmoi.homeDir }}/Brewfile"

# æ£€æŸ¥ Brewfile æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç”Ÿæˆ
if [[ ! -f "$BREWFILE_PATH" ]]; then
    echo "ğŸ“ Brewfile ä¸å­˜åœ¨ï¼Œæ­£åœ¨ä»æ¨¡æ¿ç”Ÿæˆ..."
    chezmoi execute-template < "{{ .chezmoi.sourceDir }}/Brewfile.tmpl" > "$BREWFILE_PATH"
    echo "âœ… Brewfile å·²ç”Ÿæˆ: $BREWFILE_PATH"
fi

echo "ğŸ“‹ ä½¿ç”¨ Brewfile: $BREWFILE_PATH"

# æ‰§è¡Œ brew bundle å®‰è£…
echo "âš¡ æ‰§è¡Œ brew bundle install..."
brew bundle install --file="$BREWFILE_PATH"

echo "ğŸ‰ Homebrew åŒ…å®‰è£…å®Œæˆ!"